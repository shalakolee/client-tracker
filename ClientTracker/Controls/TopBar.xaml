<?xml version="1.0" encoding="UTF-8" ?>
<ContentView
    x:Class="ClientTracker.Controls.TopBar"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:services="clr-namespace:ClientTracker.Services"
    x:Name="Root">
    <Grid Padding="{StaticResource PagePadding}" RowDefinitions="Auto,Auto" ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
        <Grid WidthRequest="40" HeightRequest="40" VerticalOptions="Center">
            <Grid.Triggers>
                <DataTrigger TargetType="Grid" Binding="{Binding NavigationMode, Source={x:Reference Root}}" Value="None">
                    <Setter Property="IsVisible" Value="False" />
                </DataTrigger>
            </Grid.Triggers>
            <ImageButton
                BackgroundColor="Transparent"
                Clicked="OnNavigationClicked"
                Source="icon_menu"
                Padding="10"
                WidthRequest="40"
                HeightRequest="40"
                IsVisible="False">
                <ImageButton.Triggers>
                    <DataTrigger TargetType="ImageButton" Binding="{Binding NavigationMode, Source={x:Reference Root}}" Value="Menu">
                        <Setter Property="IsVisible" Value="True" />
                    </DataTrigger>
                    <DataTrigger TargetType="ImageButton" Binding="{Binding IsMenuAvailable, Source={x:Reference Root}}" Value="False">
                        <Setter Property="IsVisible" Value="False" />
                    </DataTrigger>
                </ImageButton.Triggers>
            </ImageButton>

            <ImageButton
                BackgroundColor="Transparent"
                Clicked="OnNavigationClicked"
                Source="icon_back"
                Padding="10"
                WidthRequest="40"
                HeightRequest="40"
                IsVisible="False">
                <ImageButton.Triggers>
                    <DataTrigger TargetType="ImageButton" Binding="{Binding NavigationMode, Source={x:Reference Root}}" Value="Back">
                        <Setter Property="IsVisible" Value="True" />
                    </DataTrigger>
                </ImageButton.Triggers>
            </ImageButton>
        </Grid>

        <VerticalStackLayout Grid.Column="1" Spacing="2" VerticalOptions="Center">
            <Label Text="{Binding Title, Source={x:Reference Root}}" FontSize="22" FontFamily="OpenSansSemibold" />
            <Label Text="{Binding Subtitle, Source={x:Reference Root}}" Style="{StaticResource MutedLabel}" IsVisible="{Binding HasSubtitle, Source={x:Reference Root}}" />
        </VerticalStackLayout>

        <HorizontalStackLayout Grid.Column="2" Spacing="8" VerticalOptions="Center" HorizontalOptions="End">
            <ImageButton
                x:Name="SearchToggleButton"
                BackgroundColor="Transparent"
                Clicked="OnSearchToggleClicked"
                Source="icon_search"
                Padding="10"
                WidthRequest="40"
                HeightRequest="40"
                IsVisible="False" />
            <Button
                Text="{Binding Source={x:Static services:LocalizationResourceManager.Instance}, Path=[Update_Title]}"
                Style="{StaticResource InlineButton}"
                IsVisible="{Binding Source={x:Static services:UpdateService.Instance}, Path=IsUpdateAvailable}"
                Clicked="OnUpdateClicked" />
            <ContentPresenter Content="{Binding RightContent, Source={x:Reference Root}}" />
            <Border WidthRequest="38" HeightRequest="38"
                    BackgroundColor="{AppThemeBinding Light={StaticResource SurfaceAlt}, Dark={StaticResource Gray950}}"
                    StrokeThickness="0"
                    VerticalOptions="Center"
                    IsVisible="{OnIdiom Phone=False, Default=True}">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="999" />
                </Border.StrokeShape>
                <Image Source="{OnPlatform WinUI=avatar_win.png, Default=avatar}" WidthRequest="18" HeightRequest="18" HorizontalOptions="Center" VerticalOptions="Center" Opacity="0.9" />
            </Border>
        </HorizontalStackLayout>

        <SearchBar x:Name="SearchInput" Grid.Row="1" Grid.ColumnSpan="3"
                   IsVisible="{Binding IsSearchVisible, Source={x:Reference Root}}"
                   Placeholder="{Binding SearchPlaceholder, Source={x:Reference Root}}"
                   Text="{Binding SearchText, Source={x:Reference Root}, Mode=TwoWay}"
                   SearchCommand="{Binding SearchCommand, Source={x:Reference Root}}" />
    </Grid>
</ContentView>
