<?xml version="1.0" encoding="UTF-8" ?>
<ContentPage
    x:Class="ClientTracker.Pages.ContactDetailsPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:controls="clr-namespace:ClientTracker.Controls"
    xmlns:services="clr-namespace:ClientTracker.Services"
    Title="{Binding Source={x:Static services:LocalizationResourceManager.Instance}, Path=[Title_ContactDetails]}">

    <ContentPage.Background>
        <AppThemeBinding Light="{StaticResource AppBackgroundBrush}" Dark="{StaticResource AppBackgroundDarkBrush}" />
    </ContentPage.Background>

    <ContentPage.Behaviors>
        <controls:SwipeBackBehavior />
    </ContentPage.Behaviors>

    <Grid RowDefinitions="Auto,*">
        <controls:TopBar NavigationMode="Back" Title="{Binding ContactName}" Subtitle="{Binding ClientName}">
            <controls:TopBar.RightContent>
                <HorizontalStackLayout Spacing="8" VerticalOptions="Center">
                    <Button Text="{Binding Source={x:Static services:LocalizationResourceManager.Instance}, Path=[Action_Edit]}" Command="{Binding EditCommand}" Style="{StaticResource SecondaryButton}" />
                    <Button Text="{Binding Source={x:Static services:LocalizationResourceManager.Instance}, Path=[Action_Delete]}" Command="{Binding DeleteCommand}" Style="{StaticResource DangerButton}" />
                </HorizontalStackLayout>
            </controls:TopBar.RightContent>
        </controls:TopBar>

        <RefreshView Grid.Row="1" Command="{Binding RefreshCommand}" IsRefreshing="{Binding IsBusy}">
            <ScrollView>
                <VerticalStackLayout Padding="{StaticResource PagePadding}" Spacing="16">
            <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                <Label Text="{Binding Source={x:Static services:LocalizationResourceManager.Instance}, Path=[Title_ContactDetails]}" Style="{StaticResource SectionTitle}" />
                <Button Grid.Column="1"
                        Text="{Binding Source={x:Static services:LocalizationResourceManager.Instance}, Path=[Action_Edit]}"
                        Command="{Binding EditCommand}"
                        Style="{StaticResource InlineButton}" />
            </Grid>
            <Frame Style="{StaticResource CardFrame}">
                <Grid ColumnDefinitions="Auto,*" ColumnSpacing="14">
                    <Border WidthRequest="52" HeightRequest="52" BackgroundColor="{AppThemeBinding Light=#EEF2FF, Dark={StaticResource Gray900}}" StrokeThickness="0" VerticalOptions="Start">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="26" />
                        </Border.StrokeShape>
                        <Label Text="{Binding ContactInitials}" FontAttributes="Bold" HorizontalOptions="Center" VerticalOptions="Center" />
                    </Border>
                    <VerticalStackLayout Grid.Column="1" Spacing="10">
                        <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                            <Border BackgroundColor="{AppThemeBinding Light={StaticResource SurfaceAlt}, Dark={StaticResource Gray900}}" StrokeThickness="0" Padding="12,10">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="14" />
                                </Border.StrokeShape>
                                <VerticalStackLayout Spacing="2">
                                    <Label Text="{Binding Source={x:Static services:LocalizationResourceManager.Instance}, Path=[Contact_Email]}" Style="{StaticResource MutedLabel}" />
                                    <Label Text="{Binding ContactEmail}" LineBreakMode="TailTruncation" />
                                </VerticalStackLayout>
                            </Border>
                            <Border Grid.Column="1" BackgroundColor="{AppThemeBinding Light={StaticResource SurfaceAlt}, Dark={StaticResource Gray900}}" StrokeThickness="0" Padding="12,10">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="14" />
                                </Border.StrokeShape>
                                <VerticalStackLayout Spacing="2">
                                    <Label Text="{Binding Source={x:Static services:LocalizationResourceManager.Instance}, Path=[Contact_Phone]}" Style="{StaticResource MutedLabel}" />
                                    <Label Text="{Binding ContactPhone}" LineBreakMode="TailTruncation" />
                                </VerticalStackLayout>
                            </Border>
                        </Grid>
                    </VerticalStackLayout>
                </Grid>
            </Frame>

            <Frame Style="{StaticResource CardFrame}">
                <VerticalStackLayout Spacing="10">
                    <Label Text="{Binding Source={x:Static services:LocalizationResourceManager.Instance}, Path=[Contact_Notes]}" Style="{StaticResource SectionTitle}" />
                    <Label Text="{Binding NotesDisplay}" LineBreakMode="WordWrap" />
                </VerticalStackLayout>
            </Frame>

            <Label Text="{Binding StatusMessage}" TextColor="{StaticResource Tertiary}" />
                </VerticalStackLayout>
            </ScrollView>
        </RefreshView>
        <controls:LoadingOverlay Grid.RowSpan="2" ZIndex="99" />
    </Grid>
</ContentPage>




